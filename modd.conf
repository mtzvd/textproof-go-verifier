# Modd configuration file
# https://github.com/cortesi/modd

# =====================================================================
# TEMPL WATCHER - следит за .templ файлами
# =====================================================================
**/*.templ {
    prep: templ generate
}

# =====================================================================
# GO WATCHER - следит за .go файлами (кроме *_templ.go)
# =====================================================================
**/*.go !**/*_templ.go {
    prep: go test @dirmods
}

# =====================================================================
# MAIN SERVER - перезапускает сервер при изменениях
# =====================================================================
**/*.go **/*.templ !**/*_templ.go {
    prep: echo "Перезапуск сервера..."
    daemon +sigterm: go run cmd/server/main.go -port 8080 -difficulty 4
}

# =====================================================================
# SWAGGER - регенерация при изменении API
# =====================================================================
internal/api/**/*.go cmd/server/main.go {
    prep: swag init -g cmd/server/main.go -o docs --parseDependency --parseInternal --exclude web/templates
    prep: go run scripts/fixdocs.go
}

# =====================================================================
# STATIC FILES - копирование статики при изменениях
# =====================================================================
web/static/**/* {
    indir: web/static
    prep: echo "Статические файлы обновлены"
}